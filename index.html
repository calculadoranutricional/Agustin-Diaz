<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Noticias + Voz + Clima + Hora üåê</title>

<!-- Ejecutar TypeScript en navegador -->
<script src="https://cdn.jsdelivr.net/npm/typescript@5.9.2/lib/typescript.js"></script>

<script>
window.addEventListener("DOMContentLoaded", () => {
  const tsCode = document.querySelector("#ts")?.textContent ?? "";
  const jsCode = ts.transpile(tsCode, { target: "ESNext", module: "ESNext" });
  eval(jsCode);
});
</script>

<style>
*{box-sizing:border-box;}
body{
  margin:0;font-family:system-ui,sans-serif;
  background:#fff;color:#111;
  display:flex;flex-direction:column;min-height:100vh;
}
header{
  text-align:center;padding:1.2rem;border-bottom:1px solid #ddd;
}
h1{margin:0;font-size:1.8rem;font-weight:700;}
main{flex:1;padding:1rem;max-width:800px;margin:auto;width:100%;}
.tarjeta{
  background:white;border:1px solid #e5e5e5;border-radius:14px;
  padding:1.2rem;margin:1rem 0;
}
.tarjeta h3{
  margin:0 0 .7rem;font-size:1.2rem;border-bottom:1px solid #eee;padding-bottom:.4rem;
}

#categorias{
  display:flex;overflow-x:auto;gap:.6rem;padding-bottom:.3rem;
}
.categoria-btn{
  padding:.45rem .75rem;border-radius:8px;
  background:#eee;cursor:pointer;white-space:nowrap;font-size:.9rem;
}
.categoria-btn.active{background:#111;color:white;}

.noticia{
  background:#fafafa;border:1px solid #eee;border-radius:10px;
  padding:.8rem;margin:.8rem 0;
}
.noticia h4{margin:.1rem 0;font-size:1rem;}
.noticia button{
  border:none;border-radius:8px;cursor:pointer;margin-top:.4rem;
  padding:.5rem .8rem;font-size:.85rem;
}
.leer-voz{background:#0057e7;color:white;margin-left:.5rem;}
.btn-leer{background:#111;color:white;}

footer{text-align:center;border-top:1px solid #ddd;padding:1rem;font-size:.85rem;}

#modal{
  position:fixed;inset:0;background:rgba(0,0,0,.65);
  display:none;align-items:center;justify-content:center;z-index:20;
}
#modal-contenido{
  width:95%;max-width:950px;height:90vh;background:white;
  border-radius:14px;overflow:hidden;display:flex;flex-direction:column;
}
#btn-cerrar{
  background:#111;color:white;padding:.7rem;text-align:center;
  cursor:pointer;font-weight:bold;
}
iframe{border:none;flex:1;width:100%;}
</style>
</head>

<body>

<header>
  <h1>Mi Web Integrada üåê</h1>
  <p>Noticias ¬∑ Voz ¬∑ Clima ¬∑ Hora ¬∑ Categor√≠as</p>
</header>

<main>

  <section class="tarjeta">
    <h3>üìÖ Fecha & Hora</h3>
    <p id="fecha">‚è≥</p>
  </section>

  <section class="tarjeta">
    <h3>üå¶Ô∏è Clima en C√≥rdoba</h3>
    <p id="clima">Cargando clima...</p>
  </section>

  <section class="tarjeta">
    <h3>üì∞ Noticias</h3>
    <div id="categorias"></div>
    <div id="noticias">‚è≥ Cargando...</div>
  </section>

</main>

<footer>¬© 2025 ‚Äî Agust√≠n D√≠az</footer>

<!-- Modal Lectura Web -->
<div id="modal">
  <div id="modal-contenido">
    <div id="btn-cerrar">Cerrar ‚úñÔ∏è</div>
    <iframe id="visor"></iframe>
  </div>
</div>

<!-- ================= TypeScript ================= -->
<script id="ts" type="text/typescript">

// FECHA Y HORA
function actualizarFecha(){
  const f=new Date();
  fecha!.textContent=
    `${f.toLocaleDateString("es-AR")} ‚Äî ‚è± ${f.toLocaleTimeString("es-AR")}`;
}
setInterval(actualizarFecha,1000);
actualizarFecha();


// CLIMA
async function obtenerClima(){
  try{
    const r=await fetch("https://api.open-meteo.com/v1/forecast?latitude=-31.42&longitude=-64.18&current_weather=true&timezone=America%2FArgentina%2FBuenos_Aires");
    const d=await r.json();
    const c=d.current_weather;
    const icon:any={0:"‚òÄÔ∏è",1:"üå§Ô∏è",2:"‚õÖ",3:"‚òÅÔ∏è",61:"üåßÔ∏è",95:"‚õàÔ∏è"};
    clima!.textContent=`${icon[c.weathercode]??"üåç"} ${c.temperature}¬∞C ‚Äî C√≥rdoba`;
  }catch{clima!.textContent="Error clima ‚ùå"}
}
obtenerClima();


// CATEGOR√çAS
const categorias=[
 "ultimas","politica","economia","deportes","tecnologia",
 "ciencia","salud","musica","espectaculos","comedia"
];
let categoria="ultimas",pagina=0;

const contCat=document.getElementById("categorias")!;
categorias.forEach((c,i)=>{
  const b=document.createElement("div");
  b.textContent=c[0].toUpperCase()+c.slice(1);
  b.className="categoria-btn"+(i===0?" active":"");
  b.onclick=()=>seleccionar(c,i);
  contCat.appendChild(b);
});

function seleccionar(c:string,i:number){
  categoria=c;pagina=0;
  noticias!.innerHTML="";
  detenerVoz();
  document.querySelectorAll(".categoria-btn").forEach(x=>x.classList.remove("active"));
  document.querySelectorAll(".categoria-btn")[i].classList.add("active");
  cargarNoticias();
}


// üîä LECTOR DE VOZ
let vozActiva=false;
let utter:SpeechSynthesisUtterance|null=null;

function leerTexto(text:string){
  detenerVoz();
  utter=new SpeechSynthesisUtterance(text);
  utter.lang="es-AR";
  speechSynthesis.speak(utter);
  vozActiva=true;
}
function detenerVoz(){
  if(vozActiva)speechSynthesis.cancel();
  vozActiva=false;
}


// NOTICIAS (Google News RSS ‚Äî GRATIS)
async function cargarNoticias(){
  try{
    const url=`https://news.google.com/rss/search?q=${categoria}&hl=es-419&gl=AR&ceid=AR:es`;
    const r=await fetch(url);
    const t=await r.text();
    const items=[...t.matchAll(/<item>([\s\S]*?)<\/item>/g)]
      .slice(pagina*6,(pagina+1)*6);

    if(!items.length)return;

    items.forEach(i=>{
      const titulo=i[1].match(/<title>(.*?)<\/title>/)![1];
      const link=i[1].match(/<link>(.*?)<\/link>/)![1];
      const desc=i[1].match(/<description>([\s\S]*?)<\/description>/)?.[1]
                    .replace(/<[^>]+>/g,"")||titulo;

      noticias!.insertAdjacentHTML("beforeend",
        `<div class="noticia">
          <h4>${titulo}</h4>
          <button class="btn-leer" data-url="${link}">Abrir</button>
          <button class="leer-voz" data-text="${desc}">üîä</button>
        </div>`);
    });

    pagina++;
  }catch{
    noticias!.innerHTML="‚ö†Ô∏è Error al cargar noticias";
  }
}
cargarNoticias();


// Scroll infinito
window.addEventListener("scroll",()=>{
  if(window.innerHeight+window.scrollY>=document.body.offsetHeight-300){
    cargarNoticias();
  }
});


// Clicks
document.addEventListener("click",(e:any)=>{
  if(e.target.classList.contains("btn-leer")){
    detenerVoz();
    visor!.setAttribute("src",e.target.dataset.url);
    modal!.style.display="flex";
  }
  if(e.target.classList.contains("leer-voz")){
    leerTexto(e.target.dataset.text);
  }
  if(e.target.id==="btn-cerrar"){
    modal!.style.display="none";
    detenerVoz();
  }
});

</script>
</body>
</html>