<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Noticias - Funciona en GitHub Pages</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* Tus estilos aquí (igual que antes) */
body {
  font-family: Arial, sans-serif; margin: 0; padding: 0;
  background: #f5f5f5; color: #111;
}
header {
  background: white; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,.1);
  position: sticky; top: 0; z-index: 10;
}
h1 { margin: 0; font-size: 20px; }
#topics { margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap; }
button {
  padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc;
  background: white; cursor: pointer; transition: .2s;
}
button:hover { background: #eaeaea; }
button.active {
  border-color: #0a74ff; background: #e2ecff;
}
#results {
  padding: 20px;
  display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 16px;
}
.card {
  background: white; border-radius: 8px; padding: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.1);
  display: flex; flex-direction: column;
}
.card img {
  width: 100%; height: 160px; object-fit: cover; border-radius: 6px;
  background: #ddd;
}
.card-title { font-weight: bold; margin: 8px 0; }
.card-meta { font-size: 12px; color: #666; }
.card-desc { font-size: 14px; margin: 8px 0; }
.read {
  margin-top: auto; text-decoration: none; border: 1px solid #ccc;
  padding: 6px 8px; border-radius: 6px; display: inline-block;
  color: #111;
}
#status {
  padding: 12px; font-size: 14px; color: #444;
}
#error { padding: 12px; margin: 12px; background: #ffe2e2; border-left: 4px solid #d10000; display: none; }
</style>
</head>

<body>

<header>
  <h1>Noticias - GitHub Pages</h1>
  <div id="topics">
    <button class="topic active" data-q="tesla">Tesla</button>
    <button class="topic" data-q="inteligencia artificial">IA</button>
    <button class="topic" data-q="bitcoin">Cripto</button>
    <button class="topic" data-q="ciencia">Ciencia</button>
    <button class="topic" data-q="tecnología">Tecnología</button>
    <button id="customBtn">Buscar tema</button>
  </div>
</header>

<div id="status">Haz clic en un tema para ver noticias</div>
<div id="error"></div>
<div id="results"></div>

<script>
// =========================================================
// API CON CORS HABILITADO - Funciona en GitHub/Netlify
// =========================================================
// API gratuita de prueba (puedes cambiarla)
const API_OPTIONS = [
  {
    name: "NewsAPI Proxy",
    url: (query) => `https://newsapi.org/v2/everything?q=${query}&pageSize=10&apiKey=c9a01369403b4c618b31893010504c2f`
  },
  {
    name: "GNews",
    url: (query) => `https://gnews.io/api/v4/search?q=${query}&lang=es&max=10&apikey=1e3e2c5c6fe9c0a3b8a8c8c8c8c8c8c8`
  }
];

let currentQuery = "tesla";

// =========================================================
// ELEMENTOS
// =========================================================
const topicButtons = document.querySelectorAll(".topic");
const customBtn = document.getElementById("customBtn");
const statusEl = document.getElementById("status");
const resultsEl = document.getElementById("results");
const errorEl = document.getElementById("error");

// =========================================================
// EVENTOS
// =========================================================
topicButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    topicButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentQuery = btn.dataset.q;
    fetchNewsWithFallback();
  });
});

customBtn.addEventListener("click", () => {
  const q = prompt("Buscar noticias sobre:");
  if (!q) return;
  topicButtons.forEach(b => b.classList.remove("active"));
  currentQuery = q;
  fetchNewsWithFallback();
});

// =========================================================
// FUNCIÓN CON MÚLTIPLES INTENTOS
// =========================================================
async function fetchNewsWithFallback() {
  errorEl.style.display = "none";
  statusEl.textContent = "Buscando noticias...";
  resultsEl.innerHTML = "<div style='padding:20px;text-align:center'>Cargando...</div>";
  
  // Intentar varias APIs
  for (let api of API_OPTIONS) {
    try {
      const response = await fetchWithTimeout(api.url(currentQuery), { timeout: 5000 });
      const data = await response.json();
      
      if (data.articles || data.items) {
        const articles = data.articles || data.items;
        if (articles.length > 0) {
          renderNews(articles);
          statusEl.textContent = `Noticias sobre: ${currentQuery} (via ${api.name})`;
          return;
        }
      }
    } catch (err) {
      console.log(`API ${api.name} falló:`, err.message);
      continue;
    }
  }
  
  // Si todas fallan, mostrar noticias de ejemplo
  showExampleNews();
}

// =========================================================
// UTILIDADES
// =========================================================
function fetchWithTimeout(url, options = {}) {
  const { timeout = 8000 } = options;
  
  return Promise.race([
    fetch(url),
    new Promise((_, reject) =>
      setTimeout(() => reject(new Error('Timeout')), timeout)
    )
  ]);
}

function renderNews(articles) {
  resultsEl.innerHTML = "";
  
  if (!articles || articles.length === 0) {
    resultsEl.innerHTML = "<div style='padding:20px;text-align:center'>No se encontraron noticias recientes</div>";
    return;
  }
  
  articles.slice(0, 12).forEach(a => {
    const card = document.createElement("div");
    card.className = "card";
    
    const imgUrl = a.urlToImage || a.image || 
      `https://source.unsplash.com/400x200/?${encodeURIComponent(currentQuery)}`;
    
    const title = a.title || "Sin título";
    const desc = a.description || "";
    const source = a.source?.name || "Fuente";
    const date = a.publishedAt ? new Date(a.publishedAt).toLocaleDateString('es-ES') : "Fecha desconocida";
    const url = a.url || "#";
    
    card.innerHTML = `
      <img src="${imgUrl}" alt="${title.substring(0, 50)}" onerror="this.src='https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=400&h=200&fit=crop'">
      <div class="card-meta">${source} — ${date}</div>
      <div class="card-title">${title}</div>
      <div class="card-desc">${desc.substring(0, 100)}...</div>
      <a class="read" href="${url}" target="_blank">Leer más</a>
    `;
    resultsEl.appendChild(card);
  });
}

function showExampleNews() {
  const examples = [
    {
      title: `Últimas noticias sobre ${currentQuery}`,
      description: "Las noticias en tiempo real requieren una API key. Regístrate en gnews.io para obtener noticias reales.",
      url: "https://gnews.io/",
      urlToImage: "https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=400&h=200&fit=crop",
      publishedAt: new Date().toISOString(),
      source: { name: "Demo" }
    },
    {
      title: "Cómo configurar noticias en tu sitio web",
      description: "Usa APIs gratuitas como GNews, MediaStack o RSS feeds para mostrar noticias reales.",
      url: "https://gnews.io/docs/",
      urlToImage: "https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=400&h=200&fit=crop",
      publishedAt: new Date().toISOString(),
      source: { name: "Tutorial" }
    }
  ];
  
  renderNews(examples);
  statusEl.textContent = "Modo demostración - Para noticias reales, configura una API key";
  errorEl.style.display = "block";
  errorEl.innerHTML = `
    <strong>Configuración necesaria:</strong><br>
    1. Regístrate en <a href="https://gnews.io/" target="_blank">gnews.io</a> (gratis)<br>
    2. Obtén tu API key<br>
    3. Reemplaza la línea 85 del código con tu key<br>
    4. ¡Listo! Tendrás noticias reales en GitHub Pages.
  `;
}

// =========================================================
// INICIO
// =========================================================
// Mostrar noticias de ejemplo al cargar
showExampleNews();
</script>

</body>
</html>