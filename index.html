<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Noticias - Página Autocontenible</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif; margin: 0; padding: 0;
  background: #f5f5f5; color: #111;
}
header {
  background: white; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,.1);
  position: sticky; top: 0; z-index: 10;
}
h1 { margin: 0; font-size: 20px; }
#topics { margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap; }
button {
  padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc;
  background: white; cursor: pointer; transition: .2s;
}
button:hover { background: #eaeaea; }
button.active {
  border-color: #0a74ff; background: #e2ecff;
}
#results {
  padding: 20px;
  display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 16px;
}
.card {
  background: white; border-radius: 8px; padding: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.1);
  display: flex; flex-direction: column;
}
.card img {
  width: 100%; height: 160px; object-fit: cover; border-radius: 6px;
  background: #ddd;
}
.card-title { font-weight: bold; margin: 8px 0; }
.card-meta { font-size: 12px; color: #666; }
.card-desc { font-size: 14px; margin: 8px 0; }
.read {
  margin-top: auto; text-decoration: none; border: 1px solid #ccc;
  padding: 6px 8px; border-radius: 6px; display: inline-block;
  color: #111;
}
#status {
  padding: 12px; font-size: 14px; color: #444;
}
#error { padding: 12px; margin: 12px; background: #ffe2e2; border-left: 4px solid #d10000; display: none; }
</style>
</head>

<body>

<header>
  <h1>Noticias</h1>
  <div id="topics">
    <button class="topic active" data-q="tesla">Tesla</button>
    <button class="topic" data-q="ai">Inteligencia Artificial</button>
    <button class="topic" data-q="bitcoin">Criptomonedas</button>
    <button class="topic" data-q="science">Ciencia</button>
    <button class="topic" data-q="world">Mundo</button>
    <button id="customBtn">Tema personalizado</button>
  </div>
</header>

<div id="status">Listo.</div>
<div id="error"></div>
<div id="results"></div>


<script>
// =========================================================
// CONFIGURACIÓN
// =========================================================
const API_KEY = "c9a01369403b4c618b31893010504c2f";
const BASE_URL = "https://newsapi.org/v2/everything";

// =========================================================
// ELEMENTOS
// =========================================================
const topicButtons = document.querySelectorAll(".topic");
const customBtn = document.getElementById("customBtn");
const statusEl = document.getElementById("status");
const resultsEl = document.getElementById("results");
const errorEl = document.getElementById("error");

let currentQuery = "tesla";

// =========================================================
// EVENTOS
// =========================================================

// Cambiar tema
topicButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    topicButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentQuery = btn.dataset.q;
    fetchNews();
  });
});

// Tema personalizado
customBtn.addEventListener("click", () => {
  const q = prompt("Ingrese el término de búsqueda:");
  if (!q) return;
  topicButtons.forEach(b => b.classList.remove("active"));
  currentQuery = q;
  fetchNews();
});

// =========================================================
// FUNCIÓN PRINCIPAL
// =========================================================
async function fetchNews() {
  errorEl.style.display = "none";
  statusEl.textContent = "Cargando noticias...";

  const url =
    BASE_URL +
    "?q=" + encodeURIComponent(currentQuery) +
    "&from=2025-11-09" +
    "&sortBy=publishedAt" +
    "&apiKey=" + API_KEY;

  try {
    const r = await fetch(url);
    if (!r.ok) throw new Error("HTTP " + r.status);

    const data = await r.json();
    if (data.status !== "ok") throw new Error(data.message || "Error desconocido");

    renderNews(data.articles);
    statusEl.textContent = "Mostrando resultados para: " + currentQuery;

  } catch (err) {
    errorEl.style.display = "block";
    errorEl.textContent =
      "Error al obtener noticias: " + err.message +
      ". Si es un problema de CORS, es porque NewsAPI no permite llamadas desde HTML local.";
    statusEl.textContent = "Error.";
    resultsEl.innerHTML = "";
  }
}

// =========================================================
// RENDER
// =========================================================
function renderNews(articles) {
  resultsEl.innerHTML = "";

  if (!articles || articles.length === 0) {
    resultsEl.innerHTML = "<div>No se encontraron resultados.</div>";
    return;
  }

  for (const a of articles) {
    const card = document.createElement("div");
    card.className = "card";

    const img = a.urlToImage
      ? `<img src="${a.urlToImage}" alt="img">`
      : `<img src="" alt="img" style="background:#ccc;">`;

    card.innerHTML = `
      ${img}
      <div class="card-meta">${a.source?.name || ""} — ${new Date(a.publishedAt).toLocaleString()}</div>
      <div class="card-title">${a.title || "Sin título"}</div>
      <div class="card-desc">${a.description || ""}</div>
      <a class="read" href="${a.url}" target="_blank">Leer más</a>
    `;
    resultsEl.appendChild(card);
  }
}

// =========================================================
// INICIO AUTOMÁTICO
// =========================================================
fetchNews();
</script>

</body>
</html>